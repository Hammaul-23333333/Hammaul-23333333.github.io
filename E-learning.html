<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>E-Learning Platform</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0;
    padding: 0;
    height: 100vh;
    width: 100vw;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #222;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #app {
    background: #fff;
    width: 350px;
    max-width: 100vw;
    height: 600px;
    max-height: 100vh;
    border-radius: 12px;
    box-shadow: 0 12px 24px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
  }
  header {
    background: #5a4da7;
    color: #fff;
    padding: 15px 20px;
    font-size: 1.2rem;
    font-weight: 700;
    user-select: none;
  }
  main {
    flex: 1;
    display: flex;
    overflow: hidden;
  }
  nav {
    width: 100px;
    background: #4b4191;
    color: #ddd;
    display: flex;
    flex-direction: column;
    padding: 10px 0;
  }
  nav button {
    background: transparent;
    border: none;
    color: inherit;
    padding: 12px 10px;
    margin: 5px 10px;
    border-radius: 8px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  nav button:hover, nav button.active {
    background: #6e63c9;
    color: #fff;
  }
  section.content {
    flex: 1;
    background: #f9f9fb;
    padding: 15px 20px;
    overflow-y: auto;
  }
  /* Scrollbar styling */
  section.content::-webkit-scrollbar {
    width: 6px;
  }
  section.content::-webkit-scrollbar-thumb {
    background: #9a91e7;
    border-radius: 3px;
  }
  h2 {
    margin-top: 0;
    color: #5a4da7;
  }
  label {
    display: block;
    margin: 10px 0 5px;
    font-weight: 600;
  }
  input[type=email],
  input[type=password],
  input[type=text],
  input[type=date],
  input[type=number],
  select,
  textarea {
    width: 100%;
    padding: 7px 10px;
    font-size: 0.9rem;
    border-radius: 6px;
    border: 1.8px solid #ccc;
    transition: border-color 0.3s ease;
  }
  input[type=email]:focus,
  input[type=password]:focus,
  input[type=text]:focus,
  input[type=date]:focus,
  input[type=number]:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: #6e63c9;
  }

  button.primary {
    background: #5a4da7;
    color: white;
    border: none;
    padding: 10px 15px;
    margin-top: 15px;
    font-weight: 700;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%;
  }
  button.primary:hover {
    background: #7a6ed1;
  }
  .link-btn {
    background: none;
    border: none;
    color: #5a4da7;
    cursor: pointer;
    padding: 0;
    font-size: 0.9rem;
    text-decoration: underline;
    margin-top: 10px;
  }
  .link-btn:hover {
    color: #764ba2;
  }
  .message {
    margin: 10px 0;
    font-size: 0.9rem;
    color: #cc0000;
  }
  .success {
    color: green;
  }
  /* Login Screen */
  #login-screen {
    padding: 20px;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  #login-screen h1 {
    margin-bottom: 15px;
    text-align: center;
    color: #5a4da7;
  }
  /* Dashboard & Content */
  .hidden {
    display: none;
  }
  /* Table styling */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px 8px;
    text-align: left;
  }
  th {
    background: #5a4da7;
    color: white;
  }
  /* Attendance button */
  .attendance-btn {
    background: #6fcf97;
    color: #fff;
    border: none;
    padding: 10px 18px;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
    width: 100%;
    margin-top: 15px;
    font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  .attendance-btn:hover {
    background: #3ba373;
  }
  .attendance-present {
    background: #999;
    cursor: default;
  }
  /* Profile Image container */
  .profile-photo {
    display: block;
    margin: 10px auto 15px;
    width: 110px;
    height: 110px;
    border-radius: 50%;
    background: #ccc;
    overflow: hidden;
    object-fit: cover;
    border: 3px solid #5a4da7;
    cursor: pointer;
  }
  /* Responsive tweaks */
  @media (max-width: 400px) {
    #app {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
    }
    nav {
      width: 80px;
      padding: 5px 0;
    }
    nav button {
      font-size: 0.7rem;
      padding: 10px 6px;
      margin: 3px 4px;
    }
  }
  /* Screen reader only */
  .sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0,0,0,0) !important;
    border: 0 !important;
  }
</style>
</head>
<body>
<div id="app" role="main" aria-label="E-Learning Platform Application">
  <header id="header-title">E-Learning Login</header>
  <main>
    <!-- Navigation menu -->
    <nav id="menu" class="hidden" aria-label="Main menu">
      <button id="menu-dashboard" aria-controls="dashboard-section" aria-selected="true" class="active" aria-current="page" title="Dashboard">üè†<span class="sr-only">Dashboard</span></button>
      <button id="menu-jadwal" aria-controls="jadwal-section" aria-selected="false" title="Jadwal Pelajaran">üìÖ<span class="sr-only">Jadwal Pelajaran</span></button>
      <button id="menu-mata-pelajaran" aria-controls="mata-pelajaran-section" aria-selected="false" title="Mata Pelajaran">üìö<span class="sr-only">Mata Pelajaran</span></button>
      <button id="menu-kehadiran" aria-controls="kehadiran-section" aria-selected="false" title="Kehadiran">‚úÖ<span class="sr-only">Kehadiran</span></button>
      <button id="menu-ujian" aria-controls="ujian-section" aria-selected="false" title="Ujian Semester">üìù<span class="sr-only">Ujian Semester</span></button>
      <button id="menu-profil" aria-controls="profil-section" aria-selected="false" title="Profil">üë§<span class="sr-only">Profil</span></button>
      <button id="menu-asal-sekolah" aria-controls="asal-sekolah-section" aria-selected="false" title="Asal Sekolah">üè´<span class="sr-only">Asal Sekolah</span></button>
      <button id="menu-ganti-password" aria-controls="ganti-password-section" aria-selected="false" title="Ganti Password">üîí<span class="sr-only">Ganti Password</span></button>
      <button id="menu-pengaturan" aria-controls="pengaturan-section" aria-selected="false" title="Pengaturan">‚öôÔ∏è<span class="sr-only">Pengaturan</span></button>
      <button id="menu-logout" title="Logout">üö™<span class="sr-only">Logout</span></button>
    </nav>
    <!-- Content area -->
    <section class="content" tabindex="0">
      <!-- LOGIN SCREEN -->
      <div id="login-screen">
        <h1>Masuk ke E-Learning</h1>
        <form id="login-form" aria-label="Login form">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" name="email" aria-required="true" autocomplete="username" placeholder="you@example.com" required />
          <label for="login-password">Password</label>
          <input type="password" id="login-password" name="password" aria-required="true" autocomplete="current-password" placeholder="********" required minlength="6" />
          <button type="submit" class="primary">Masuk</button>
        </form>
        <button id="forgot-password-btn" class="link-btn">Lupa Password?</button>
        <div id="login-message" class="message" aria-live="polite" role="alert"></div>
      </div>
      <!-- DASHBOARD -->
      <div id="dashboard-section" class="hidden" aria-label="Dashboard">
        <h2>Dashboard</h2>
        <p>Selamat datang di E-Learning, <span id="user-name-display"></span>!</p>
        <p>Gunakan menu di sebelah kiri untuk mengakses berbagai fitur.</p>
        <p><strong>Kegunaan E-Learning:</strong></p>
        <ul>
          <li>Mengelola jadwal pelajaran untuk memantau waktu dan materi pembelajaran Anda.</li>
          <li>Mengakses daftar lengkap mata pelajaran untuk memperdalam pengetahuan di setiap bidang studi.</li>
          <li>Mengisi kehadiran secara digital dengan sekali klik, memudahkan absensi harian.</li>
          <li>Mengikuti ujian semester untuk menguji pemahaman dan kompetensi pada setiap mata pelajaran.</li>
          <li>Melihat dan memperbarui data profil agar informasi Anda selalu akurat dan terkini.</li>
          <li>Mencatat asal sekolah serta tahun kelulusan sebagai bagian dari data akademik Anda.</li>
          <li>Mengelola pengaturan aplikasi sesuai kebutuhan Anda.</li>
          <li>Memudahkan komunikasi dan administrasi pendidikan di era digital.</li>
        </ul>
      </div>
      <!-- Jadwal Pelajaran -->
      <div id="jadwal-section" class="hidden" aria-label="Jadwal Pelajaran">
        <h2>Jadwal Pelajaran</h2>
        <table aria-describedby="jadwal-description" role="grid">
          <caption id="jadwal-description" class="sr-only">Jadwal Pelajaran Mingguan</caption>
          <thead>
            <tr>
              <th scope="col">Hari</th>
              <th scope="col">Waktu</th>
              <th scope="col">Mata Pelajaran</th>
            </tr>
          </thead>
          <tbody id="jadwal-tbody"></tbody>
        </table>
      </div>
      <!-- Mata Pelajaran -->
      <div id="mata-pelajaran-section" class="hidden" aria-label="Mata Pelajaran">
        <h2>Mata Pelajaran</h2>
        <ul id="mata-pelajaran-list" aria-live="polite" role="list"></ul>
      </div>
      <!-- Kehadiran -->
      <div id="kehadiran-section" class="hidden" aria-label="Kehadiran">
        <h2>Kehadiran</h2>
        <p>Klik tombol di bawah untuk mengisi kehadiran hari ini.</p>
        <button id="attendance-btn" class="attendance-btn" aria-pressed="false" aria-describedby="attendance-desc">Hadir</button>
        <p id="attendance-desc" class="sr-only">Klik tombol untuk mengisi kehadiran hari ini</p>
        <p id="attendance-message" class="message" aria-live="polite"></p>
      </div>
      <!-- Ujian Semester -->
      <div id="ujian-section" class="hidden" aria-label="Ujian Semester">
        <h2>Ujian Semester</h2>
        <p>Pilih mata pelajaran untuk memulai ujian:</p>
        <ul id="ujian-subjects-list" role="list"></ul>
        <div id="ujian-content" class="hidden" aria-live="polite" aria-atomic="true"></div>
      </div>
      <!-- Profil -->
      <div id="profil-section" class="hidden" aria-label="Profil Pengguna">
        <h2>Profil</h2>
        <img src="" alt="Foto Profil" id="profile-photo" class="profile-photo" tabindex="0" />
        <input type="file" id="profile-photo-input" accept="image/*" class="hidden" aria-hidden="true" />
        <form id="profile-form">
          <label for="prof-nama">Nama Lengkap</label>
          <input type="text" id="prof-nama" name="nama" required />
          <label for="prof-tgl-lahir">Tanggal Lahir</label>
          <input type="date" id="prof-tgl-lahir" name="tanggal_lahir" required />
          <label for="prof-kota-lahir">Kota Kelahiran</label>
          <input type="text" id="prof-kota-lahir" name="kota_lahir" />
          <label for="prof-alamat">Alamat Lengkap</label>
          <textarea id="prof-alamat" name="alamat" rows="3"></textarea>
          <label for="prof-orangtua1">Nama Orang Tua 1</label>
          <input type="text" id="prof-orangtua1" name="orangtua1" />
          <label for="prof-orangtua2">Nama Orang Tua 2</label>
          <input type="text" id="prof-orangtua2" name="orangtua2" />
          <label for="prof-hp">No. HP</label>
          <input type="text" id="prof-hp" name="hp" pattern="^[0-9+ -]{5,15}$" placeholder="+62xxxxxxx" />
          <button type="submit" class="primary">Simpan Profil</button>
          <div id="profile-message" class="message" aria-live="polite"></div>
        </form>
      </div>
      <!-- Asal Sekolah -->
      <div id="asal-sekolah-section" class="hidden" aria-label="Asal Sekolah">
        <h2>Asal Sekolah</h2>
        <form id="asal-sekolah-form">
          <label for="asal-nama-sekolah">Nama Sekolah</label>
          <input type="text" id="asal-nama-sekolah" name="nama_sekolah" />
          <label for="asal-tahun-lulus">Tahun Lulus</label>
          <input type="number" id="asal-tahun-lulus" name="tahun_lulus" min="1900" max="2099" />
          <button type="submit" class="primary">Simpan Data Sekolah</button>
          <div id="asal-sekolah-message" class="message" aria-live="polite"></div>
        </form>
      </div>
      <!-- Ganti Password -->
      <div id="ganti-password-section" class="hidden" aria-label="Ganti Password">
        <h2>Ganti Password</h2>
        <form id="ganti-password-form">
          <label for="old-password">Password Lama</label>
          <input type="password" id="old-password" name="old-password" required minlength="6" />
          <label for="new-password">Password Baru</label>
          <input type="password" id="new-password" name="new-password" required minlength="6" />
          <label for="confirm-password">Konfirmasi Password Baru</label>
          <input type="password" id="confirm-password" name="confirm-password" required minlength="6" />
          <button type="submit" class="primary">Ubah Password</button>
          <div id="ganti-password-message" class="message" aria-live="polite"></div>
        </form>
      </div>
      <!-- Pengaturan -->
      <div id="pengaturan-section" class="hidden" aria-label="Pengaturan">
        <h2>Pengaturan</h2>
        <p>Pengaturan aplikasi akan datang di versi berikutnya.</p>
      </div>
    </section>
  </main>
</div>

<script>
(() => {
  // Initial user data for demo
  const demoUser = {
    email: "mamangkasyep@gmail.com",
    password: "12345678",
    profile: {
      nama: "Ahmad Fauzi",
      tanggal_lahir: "2005-05-18",
      kota_lahir: "Jakarta",
      alamat: "Jl. Kebon Kacang No.12",
      orangtua1: "Bapak Fauzi",
      orangtua2: "Ibu Sari",
      hp: "+6281234567890",
      photo: ""
    },
    asalSekolah: {
      nama_sekolah: "SMA Negeri 1 Jakarta",
      tahun_lulus: 2023
    },
    attendanceDates: [],
    schedule: [
      { hari: "Senin", waktu: "07:00 - 09:00", mata_pelajaran: "Matematika" },
      { hari: "Senin", waktu: "09:15 - 11:00", mata_pelajaran: "Bahasa Indonesia" },
      { hari: "Selasa", waktu: "07:00 - 09:00", mata_pelajaran: "Bahasa Inggris" },
      { hari: "Rabu", waktu: "07:00 - 09:00", mata_pelajaran: "Fisika" },
      { hari: "Kamis", waktu: "09:15 - 11:00", mata_pelajaran: "Kimia" },
      { hari: "Jumat", waktu: "07:00 - 09:00", mata_pelajaran: "Sejarah" }
    ],
    subjects: [
      "Matematika",
      "Bahasa Indonesia",
      "Bahasa Inggris",
      "Fisika",
      "Kimia",
      "Sejarah"
    ]
  };

  // DOM elements
  const headerTitle = document.getElementById("header-title");
  const loginScreen = document.getElementById("login-screen");
  const loginForm = document.getElementById("login-form");
  const loginMessage = document.getElementById("login-message");
  const forgotPasswordBtn = document.getElementById("forgot-password-btn");

  const menu = document.getElementById("menu");

  // Sections
  const sections = {
    dashboard: document.getElementById("dashboard-section"),
    jadwal: document.getElementById("jadwal-section"),
    mataPelajaran: document.getElementById("mata-pelajaran-section"),
    kehadiran: document.getElementById("kehadiran-section"),
    ujian: document.getElementById("ujian-section"),
    profil: document.getElementById("profil-section"),
    asalSekolah: document.getElementById("asal-sekolah-section"),
    gantiPassword: document.getElementById("ganti-password-section"),
    pengaturan: document.getElementById("pengaturan-section")
  };

  // Menu buttons
  const menuButtons = {
    dashboard: document.getElementById("menu-dashboard"),
    jadwal: document.getElementById("menu-jadwal"),
    mataPelajaran: document.getElementById("menu-mata-pelajaran"),
    kehadiran: document.getElementById("menu-kehadiran"),
    ujian: document.getElementById("menu-ujian"),
    profil: document.getElementById("menu-profil"),
    asalSekolah: document.getElementById("menu-asal-sekolah"),
    gantiPassword: document.getElementById("menu-ganti-password"),
    pengaturan: document.getElementById("menu-pengaturan"),
    logout: document.getElementById("menu-logout")
  };

  // Other elements
  const userNameDisplay = document.getElementById("user-name-display");
  const jadwalTbody = document.getElementById("jadwal-tbody");
  const mataPelajaranList = document.getElementById("mata-pelajaran-list");
  const ujianSubjectsList = document.getElementById("ujian-subjects-list");
  const ujianContent = document.getElementById("ujian-content");
  const attendanceBtn = document.getElementById("attendance-btn");
  const attendanceMessage = document.getElementById("attendance-message");

  // Profile
  const profilePhoto = document.getElementById("profile-photo");
  const profilePhotoInput = document.getElementById("profile-photo-input");
  const profileForm = document.getElementById("profile-form");
  const profileMessage = document.getElementById("profile-message");

  // Asal Sekolah
  const asalSekolahForm = document.getElementById("asal-sekolah-form");
  const asalSekolahMessage = document.getElementById("asal-sekolah-message");

  // Ganti Password
  const gantiPasswordForm = document.getElementById("ganti-password-form");
  const gantiPasswordMessage = document.getElementById("ganti-password-message");

  // Local storage keys
  const STORAGE_KEY = "elearning-user-data";

  // Current logged in user state
  let currentUser = null;

  // Utility Functions
  function saveUserData(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }
  function loadUserData() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
      try {
        return JSON.parse(stored);
      } catch {
        return null;
      }
    }
    return null;
  }
  function formatDate(dateStr) {
    if (!dateStr) return "";
    const d = new Date(dateStr);
    if (isNaN(d)) return "";
    return d.toLocaleDateString("id-ID", {year:'numeric', month:'long', day:'numeric'});
  }

  function updateHeaderTitle(text) {
    headerTitle.textContent = text;
  }

  function clearMessages() {
    loginMessage.textContent = "";
    attendanceMessage.textContent = "";
    profileMessage.textContent = "";
    asalSekolahMessage.textContent = "";
    gantiPasswordMessage.textContent = "";
  }

  // Render functions
  function renderDashboard() {
    userNameDisplay.textContent = currentUser.profile.nama || currentUser.email;
  }

  function renderJadwal() {
    jadwalTbody.innerHTML = "";
    currentUser.schedule.forEach(item => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${item.hari}</td><td>${item.waktu}</td><td>${item.mata_pelajaran}</td>`;
      jadwalTbody.appendChild(tr);
    });
  }
  function renderMataPelajaran() {
    mataPelajaranList.innerHTML = "";
    currentUser.subjects.forEach(subj => {
      const li = document.createElement("li");
      li.textContent = subj;
      mataPelajaranList.appendChild(li);
    });
  }

  function renderUjianSubjects() {
    ujianSubjectsList.innerHTML = "";
    currentUser.subjects.forEach(subj => {
      const li = document.createElement("li");
      const btn = document.createElement("button");
      btn.textContent = "Mulai Ujian " + subj;
      btn.className = "primary";
      btn.style.fontSize = "0.9rem";
      btn.addEventListener("click", () => startExam(subj));
      li.appendChild(btn);
      ujianSubjectsList.appendChild(li);
    });
    ujianContent.classList.add("hidden");
    ujianContent.innerHTML = "";
  }

  let currentExam = null;

  function startExam(subject) {
    currentExam = {
      subject,
      questions: [
        { question: `Soal 1 dari ${subject}: Apa itu ${subject}?`, options: ["Pilihan A", "Pilihan B", "Pilihan C", "Pilihan D"], answer: 0 },
        { question: `Soal 2 dari ${subject}: Jelaskan konsep dasar ${subject}?`, options: ["Jawaban A", "Jawaban B", "Jawaban C", "Jawaban D"], answer: 1 },
        { question: `Soal 3 dari ${subject}: Bagaimana cara menerapkan ${subject}?`, options: ["Metode A", "Metode B", "Metode C", "Metode D"], answer: 2 }
      ],
      currentQuestionIndex: 0,
      score: 0
    };
    renderExamQuestion();
  }

  function renderExamQuestion() {
    if (!currentExam) return;

    const qidx = currentExam.currentQuestionIndex;
    const question = currentExam.questions[qidx];

    let html = `<h3>Ujian: ${currentExam.subject}</h3>`;
    html += `<p><strong>${question.question}</strong></p>`;
    html += '<form id="exam-form">';
    question.options.forEach((opt, i) => {
      html += `<label><input type="radio" name="answer" value="${i}" required /> ${opt}</label><br />`;
    });
    html += '<button type="submit" class="primary" style="margin-top:1em;">Jawab</button>';
    html += '</form>';
    ujianContent.innerHTML = html;
    ujianContent.classList.remove("hidden");

    // Add event listener submit
    const examForm = document.getElementById("exam-form");
    examForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const formData = new FormData(examForm);
      const ans = parseInt(formData.get("answer"));
      if (ans === currentExam.questions[qidx].answer) {
        currentExam.score++;
      }
      currentExam.currentQuestionIndex++;
      if (currentExam.currentQuestionIndex < currentExam.questions.length) {
        renderExamQuestion();
      } else {
        renderExamResult();
      }
    });
  }

  function renderExamResult() {
    const score = currentExam.score;
    const total = currentExam.questions.length;
    ujianContent.innerHTML = `<h3>Hasil Ujian: ${currentExam.subject}</h3>
      <p>Skor Anda: ${score} dari ${total}</p>
      <button class="primary" id="ujian-back">Kembali ke Pilihan Ujian</button>`;
    const backBtn = document.getElementById('ujian-back');
    backBtn.addEventListener("click", () => {
      currentExam = null;
      ujianContent.classList.add("hidden");
      renderUjianSubjects();
    });
  }

  function renderAttendance() {
    const today = new Date().toISOString().slice(0,10);
    const present = currentUser.attendanceDates.includes(today);
    attendanceBtn.disabled = present;
    attendanceBtn.classList.toggle("attendance-present", present);
    attendanceBtn.setAttribute("aria-pressed", present.toString());
    attendanceBtn.textContent = present ? "Sudah Hadir Hari Ini" : "Hadir";
    attendanceMessage.textContent = "";
  }

  function markAttendance() {
    const today = new Date().toISOString().slice(0,10);
    if (!currentUser.attendanceDates.includes(today)) {
      currentUser.attendanceDates.push(today);
      saveUserData(currentUser);
      renderAttendance();
      attendanceMessage.textContent = "Kehadiran berhasil dicatat untuk hari ini.";
      attendanceMessage.className = "message success";
    } else {
      attendanceMessage.textContent = "Anda sudah mengisi kehadiran hari ini.";
      attendanceMessage.className = "message";
    }
  }

  // Load profile data into form
  function loadProfileForm() {
    const p = currentUser.profile;
    document.getElementById("prof-nama").value = p.nama || "";
    document.getElementById("prof-tgl-lahir").value = p.tanggal_lahir || "";
    document.getElementById("prof-kota-lahir").value = p.kota_lahir || "";
    document.getElementById("prof-alamat").value = p.alamat || "";
    document.getElementById("prof-orangtua1").value = p.orangtua1 || "";
    document.getElementById("prof-orangtua2").value = p.orangtua2 || "";
    document.getElementById("prof-hp").value = p.hp || "";
    if (p.photo) {
      profilePhoto.src = p.photo;
    } else {
      profilePhoto.src = "https://via.placeholder.com/110x110?text=No+Photo";
    }
  }

  // Save profile form data
  profileForm.addEventListener("submit", (e) => {
    e.preventDefault();
    clearMessages();
    const p = currentUser.profile;
    p.nama = document.getElementById("prof-nama").value.trim();
    p.tanggal_lahir = document.getElementById("prof-tgl-lahir").value;
    p.kota_lahir = document.getElementById("prof-kota-lahir").value.trim();
    p.alamat = document.getElementById("prof-alamat").value.trim();
    p.orangtua1 = document.getElementById("prof-orangtua1").value.trim();
    p.orangtua2 = document.getElementById("prof-orangtua2").value.trim();
    p.hp = document.getElementById("prof-hp").value.trim();
    saveUserData(currentUser);
    profileMessage.textContent = "Profil berhasil disimpan.";
    profileMessage.className = "message success";
  });

  // Profile photo upload handler
  profilePhoto.addEventListener("click", () => {
    profilePhotoInput.click();
  });
  profilePhotoInput.addEventListener("change", () => {
    const file = profilePhotoInput.files[0];
    if (!file) return;
    const fr = new FileReader();
    fr.onload = e => {
      profilePhoto.src = e.target.result;
      currentUser.profile.photo = e.target.result;
      saveUserData(currentUser);
    };
    fr.readAsDataURL(file);
  });

  // Load Asal Sekolah form
  function loadAsalSekolahForm() {
    const s = currentUser.asalSekolah;
    document.getElementById("asal-nama-sekolah").value = s.nama_sekolah || "";
    document.getElementById("asal-tahun-lulus").value = s.tahun_lulus || "";
  }
  asalSekolahForm.addEventListener("submit", (e) => {
    e.preventDefault();
    clearMessages();
    const s = currentUser.asalSekolah;
    s.nama_sekolah = document.getElementById("asal-nama-sekolah").value.trim();
    s.tahun_lulus = parseInt(document.getElementById("asal-tahun-lulus").value) || null;
    saveUserData(currentUser);
    asalSekolahMessage.textContent = "Data asal sekolah berhasil disimpan.";
    asalSekolahMessage.className = "message success";
  });

  // Ganti password form handler
  gantiPasswordForm.addEventListener("submit", (e) => {
    e.preventDefault();
    clearMessages();
    const oldPass = document.getElementById("old-password").value;
    const newPass = document.getElementById("new-password").value;
    const confirmPass = document.getElementById("confirm-password").value;
    if (oldPass !== currentUser.password) {
      gantiPasswordMessage.textContent = "Password lama tidak cocok.";
      gantiPasswordMessage.className = "message";
      return;
    }
    if (newPass !== confirmPass) {
      gantiPasswordMessage.textContent = "Konfirmasi password baru tidak cocok.";
      gantiPasswordMessage.className = "message";
      return;
    }
    if (newPass.length < 6) {
      gantiPasswordMessage.textContent = "Password baru minimal 6 karakter.";
      gantiPasswordMessage.className = "message";
      return;
    }
    currentUser.password = newPass;
    saveUserData(currentUser);
    gantiPasswordMessage.textContent = "Password berhasil diubah.";
    gantiPasswordMessage.className = "message success";
    gantiPasswordForm.reset();
  });

  // Switch visible section
  function showSection(name) {
    Object.entries(sections).forEach(([key, section]) => {
      if (key === name) {
        section.classList.remove("hidden");
        menuButtons[key].classList.add("active");
        menuButtons[key].setAttribute("aria-selected", "true");
        menuButtons[key].setAttribute("aria-current", "page");
      } else {
        section.classList.add("hidden");
        if (menuButtons[key]) {
          menuButtons[key].classList.remove("active");
          menuButtons[key].setAttribute("aria-selected", "false");
          menuButtons[key].removeAttribute("aria-current");
        }
      }
    });
    clearMessages();
    // Update header title
    const titles = {
      dashboard: "E-Learning Dashboard",
      jadwal: "Jadwal Pelajaran",
      mataPelajaran: "Mata Pelajaran",
      kehadiran: "Kehadiran",
      ujian: "Ujian Semester",
      profil: "Profil",
      asalSekolah: "Asal Sekolah",
      gantiPassword: "Ganti Password",
      pengaturan: "Pengaturan"
    };
    updateHeaderTitle(titles[name] || "E-Learning");
  }

  // Render all for current user after login
  function renderAll() {
    renderDashboard();
    renderJadwal();
    renderMataPelajaran();
    renderUjianSubjects();
    renderAttendance();
    loadProfileForm();
    loadAsalSekolahForm();
  }

  // Menu button click handlers
  menuButtons.dashboard.addEventListener("click", () => showSection("dashboard"));
  menuButtons.jadwal.addEventListener("click", () => showSection("jadwal"));
  menuButtons.mataPelajaran.addEventListener("click", () => showSection("mataPelajaran"));
  menuButtons.kehadiran.addEventListener("click", () => showSection("kehadiran"));
  menuButtons.ujian.addEventListener("click", () => showSection("ujian"));
  menuButtons.profil.addEventListener("click", () => showSection("profil"));
  menuButtons.asalSekolah.addEventListener("click", () => showSection("asalSekolah"));
  menuButtons.gantiPassword.addEventListener("click", () => showSection("gantiPassword"));
  menuButtons.pengaturan.addEventListener("click", () => showSection("pengaturan"));
  
  menuButtons.logout.addEventListener("click", () => {
    if (confirm("Apakah Anda yakin ingin logout?")) {
      logout();
    }
  });

  // Attendance button click
  attendanceBtn.addEventListener("click", () => {
    markAttendance();
  });

  // Login form submit
  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    clearMessages();
    const email = loginForm.email.value.trim().toLowerCase();
    const password = loginForm.password.value;
    if (!email || !password) {
      loginMessage.textContent = "Email dan password harus diisi.";
      return;
    }
    if (currentUser && currentUser.email === email && currentUser.password === password) {
      loginSuccess();
      return;
    }
    // Check storage for matching user
    const storedUser = loadUserData();
    if (storedUser && storedUser.email === email && storedUser.password === password) {
      currentUser = storedUser;
      loginSuccess();
    } else if (email === demoUser.email && password === demoUser.password) {
      currentUser = JSON.parse(JSON.stringify(demoUser)); // clone
      // Save demo user to localStorage to persist any changes
      saveUserData(currentUser);
      loginSuccess();
    } else {
      loginMessage.textContent = "Email atau password salah.";
    }
  });

  // Forgot password button
  forgotPasswordBtn.addEventListener("click", () => {
    const email = prompt("Masukkan email Anda untuk reset password:");
    if (!email) return;
    // For demo, just show alert that email sent
    alert(`Instruksi reset password telah dikirim ke ${email}.\n(Note: Ini hanya demo, tidak benar-benar mengirim email.)`);
  });

  // Login success handler
  function loginSuccess() {
    loginMessage.textContent = "";
    loginScreen.classList.add("hidden");
    menu.classList.remove("hidden");
    showSection("dashboard");
    headerTitle.textContent = "E-Learning Dashboard";
    renderAll();
  }

  // Logout function
  function logout() {
    currentUser = null;
    updateHeaderTitle("E-Learning Login");
    loginScreen.classList.remove("hidden");
    menu.classList.add("hidden");
    Object.values(sections).forEach(section => section.classList.add("hidden"));
    loginForm.reset();
    clearMessages();
  }

  // On page load check if user data in localStorage (auto-login)
  function init() {
    const storedUser = loadUserData();
    if (storedUser) {
      currentUser = storedUser;
      loginSuccess();
    } else {
      logout();
    }
  }

  // Accessibility: keyboard navigation support on profile photo
  profilePhoto.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      profilePhotoInput.click();
    }
  });

  // Initialization
  init();
})();
</script>

</body>
</html>

